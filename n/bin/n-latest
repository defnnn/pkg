#!/usr/bin/env bash

function main {
	set -efu
  
  local repo="$(cat flake.json | jq -r '.ghrepo')"

  if [[ "${repo}" == "null" ]]; then
    cat VERSION
  else
    gh release list --repo "$repo" --exclude-pre-releases --exclude-drafts | grep Latest | awk '{print $(NF-1)}' | cut -d/ -f 2- | if ! egrep -s '^[a-z]'; then cut -d- -f2-; else cat; fi | sed 's#v##'
  fi | perl -pe 's{\s+$}{}'
}

source sub "$0" "$@"
